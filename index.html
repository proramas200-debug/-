<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>วงล้อสุ่มชื่อพร้อมเสียงฝัง</title>
<style>
  body {
    font-family: Arial, sans-serif;
    text-align: center;
    margin-top: 50px;
    background: #f0f0f0;
  }

  #wheelContainer {
    position: relative;
    width: 600px;
    height: 600px;
    margin: 0 auto;
  }

  svg {
    width: 100%;
    height: 100%;
    transform: rotate(0deg);
  }

  .pointer {
    width: 0; 
    height: 0; 
    border-left: 20px solid transparent;
    border-right: 20px solid transparent;
    border-bottom: 30px solid #333;
    position: absolute;
    top: 50%;
    left: 100%;
    transform: translateY(-50%) rotate(90deg);
  }

  #spinButton {
    margin-top: 30px;
    padding: 10px 20px;
    font-size: 18px;
    cursor: pointer;
  }
</style>
</head>
<body>

<h1>วงล้อสุ่มชื่อ</h1>
<div id="wheelContainer">
  <svg id="wheel" viewBox="0 0 400 400"></svg>
  <div class="pointer"></div>
</div>
<button id="spinButton">หมุนวงล้อ</button>
<p id="result"></p>

<script>
// --- ตัวแปรข้อมูล ---
let names = ["เชอรี่003", "เขม004", "เจน005", "ปอ009", "หวาย012", "แจน013", "นุ้งนิ้ง015", "ออม016", "โอม017", "บัว019", "แบม020", "เค้ก020", "โอ023", "พิน025", "แจกัน026", "ชมพู่028", "ใบเตย029", "อาม031", "ปอ033", "ต้า035", "มิ้น036", "อาย038", "โม040", "แมงปอ043", "น้ำอิง082", "มุก084"];
let colors = ["#f44336","#4caf50","#2196f3","#ffeb3b","#9c27b0","#ff9800"];
// กำหนดน้ำหนักสุ่มแต่ละช่อง (แก้ค่าได้ตามต้องการ)
let weights = [0, 0, 0, 50, 0, 0, 0, 10, 0, 10, 0, 50, 0, 0, 0, 0, 10, 10, 0, 0, 0, 0, 0, 0, 0, 0]; // ค่าเริ่มต้นเท่ากันทุกชื่อ

const wheel = document.getElementById('wheel');
const result = document.getElementById('result');

// --- เสียงฝัง Base64 ---
const tickSound = new Audio("data:audio/mp3;base64,TICK_BASE64"); // แทน Base64 จริง
const cheerSound = new Audio("data:audio/mp3;base64,CHEER_BASE64"); // แทน Base64 จริง

// --- ฟังก์ชันวาดวงล้อ ---
function drawWheel() {
    wheel.innerHTML = ""; // ล้าง SVG
    const numSegments = names.length;
    const center = 200;
    const radius = 180;

    for(let i = 0; i < numSegments; i++) {
        const angleStart = (360/numSegments) * i;
        const angleEnd = (360/numSegments) * (i+1);

        const x1 = center + radius * Math.cos(angleStart*Math.PI/180);
        const y1 = center + radius * Math.sin(angleStart*Math.PI/180);
        const x2 = center + radius * Math.cos(angleEnd*Math.PI/180);
        const y2 = center + radius * Math.sin(angleEnd*Math.PI/180);

        // วาดช่องวงล้อ
        const path = document.createElementNS("http://www.w3.org/2000/svg","path");
        path.setAttribute("d", `M${center},${center} L${x1},${y1} A${radius},${radius} 0 0,1 ${x2},${y2} Z`);
        path.setAttribute("fill", colors[i % colors.length]);
        wheel.appendChild(path);

        // วางข้อความตรงตามรัศมี
        const text = document.createElementNS("http://www.w3.org/2000/svg","text");
        const textAngle = angleStart + (angleEnd - angleStart)/2;
        const textRadius = radius * 0.65;
        const textX = center + textRadius * Math.cos(textAngle * Math.PI / 180);
        const textY = center + textRadius * Math.sin(textAngle * Math.PI / 180);

        text.setAttribute("x", textX);
        text.setAttribute("y", textY);
        text.setAttribute("fill", "#fff");
        text.setAttribute("font-size", "14");
        text.setAttribute("text-anchor", "middle");
        text.setAttribute("dominant-baseline", "middle");
        text.setAttribute("transform", `rotate(${textAngle}, ${textX}, ${textY})`);
        text.textContent = names[i];
        wheel.appendChild(text);
    }
}

// --- ฟังก์ชันสุ่มแบบ Weighted ---
function weightedRandomIndex(weights) {
    const sum = weights.reduce((a,b)=>a+b,0);
    let rand = Math.random() * sum;
    for(let i=0;i<weights.length;i++){
        if(rand < weights[i]) return i;
        rand -= weights[i];
    }
    return weights.length - 1;
}

// --- ฟังก์ชันหมุนวงล้อ ---
function spinWheel() {
    if(names.length === 0){
        result.textContent = "ไม่มีช่องให้สุ่มแล้ว!";
        return;
    }

    const numSegments = names.length;
    const segmentAngle = 360 / numSegments;
    const randomIndex = weightedRandomIndex(weights); // ใช้ weighted random
    const spins = 7;
    const targetAngle = randomIndex * segmentAngle + segmentAngle / 2;
    const rotateDegree = spins * 360 - targetAngle;
    const duration = 7000;
    const start = performance.now();
    let lastSegment = -1;

    function animate(now){
        const elapsed = now - start;
        const progress = Math.min(elapsed / duration, 1);
        const eased = 1 - Math.pow(1 - progress, 3);

        const currentRotation = rotateDegree * eased;
        wheel.style.transform = `rotate(${currentRotation}deg)`;

        const normalizedRotation = ((currentRotation % 360) + 360) % 360;
        const currentSegment = Math.floor(normalizedRotation / segmentAngle);

        if(currentSegment !== lastSegment){
            tickSound.currentTime = 0;
            tickSound.play().catch(()=>{});
            lastSegment = currentSegment;
        }

        if(progress < 1){
            requestAnimationFrame(animate);
        } else {
            result.textContent = `ผลลัพธ์: ${names[randomIndex]}`;
            cheerSound.play().catch(()=>{});

            // ลบชื่อ สี และ weight หลังสุ่มแล้ว
            names.splice(randomIndex, 1);
            colors.splice(randomIndex, 1);
            weights.splice(randomIndex, 1);

            drawWheel();
        }
    }

    requestAnimationFrame(animate);
}

// ผูกปุ่มกับฟังก์ชัน
document.getElementById('spinButton').addEventListener('click', spinWheel);

// วาดวงล้อเริ่มต้น
drawWheel();
</script>

</body>
</html>
